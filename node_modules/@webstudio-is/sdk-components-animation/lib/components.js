//! SPDX-License-Identifier: LicenseRef-Webstudio,Inc-Proprietary
"use strict";import{jsxs as _,Fragment as Q,jsx as C}from"react/jsx-runtime";import{useSyncExternalStore as ze,use as X,useEffect as P,useState as I,useRef as O,useLayoutEffect as ye,forwardRef as R,useId as G,useContext as U,Children as J,createElement as Be,Suspense as De,useMemo as Je,isValidElement as Ye,cloneElement as Ke}from"react";import{camelCase as Qe}from"change-case";import{ErrorBoundary as Xe}from"react-error-boundary";import{toValue as V}from"@webstudio-is/css-engine/runtime";import{animationCanPlayOnCanvasProperty as Ge}from"@webstudio-is/sdk/runtime";import{ReactSdkContext as Z}from"@webstudio-is/react-sdk/runtime";import{shallowEqual as ee}from"shallow-equal";import{atom as we,computed as Ue}from"nanostores";const Ze=({fallback:e,children:n})=>ze(()=>()=>{},()=>!1,()=>!0)?e:n;let z=null,be;const et=async()=>{var e;if(typeof ViewTimeline>"u")return!0;const n=/134\.0\.0\.0/;if(!navigator.userAgent.match(n))return!1;let t=null;if(navigator.userAgentData)try{const s=(e=(await navigator.userAgentData.getHighEntropyValues(["fullVersionList"])).fullVersionList)==null?void 0:e.find(a=>a.brand==="Google Chrome"||a.brand==="Chromium");t=s?.version||null}catch(s){console.warn("Could not fetch full version:",s)}if(t===null)return!0;const i=t.split(".").map(s=>parseInt(s,10)),r=[134,0,6998,0],o=[134,0,6998,164];for(let s=0;s<i.length;s++)if(i[s]<r[s]||i[s]>o[s])return!1;return!0},tt=e=>z!==null?z:e?(z=import("./index-DhGZj8eD.js"),z):(z=Promise.resolve(),z),xe=et();xe.then(e=>{be=e,typeof window<"u"&&(window.__ws__tmp_isPolyfillRequired=e)});const nt=()=>{const e=X(xe);X(tt(e)),P(()=>{if(!e||/^((?!chrome|android).)*safari/i.test(navigator.userAgent))return;const n=new AbortController;return window.addEventListener("unload",()=>{},{signal:n.signal}),()=>{n.abort()}},[e])},rt=()=>new Promise(e=>setTimeout(e,1e3)),ot=()=>{const[e]=I(rt);X(e)},it=["%","px","cm","mm","q","in","pt","pc","em","rem","ex","rex","cap","rcap","ch","rch","lh","rlh","vw","svw","lvw","dvw","vh","svh","lvh","dvh","vi","svi","lvi","dvi","vb","svb","lvb","dvb","vmin","svmin","lvmin","dvmin","vmax","svmax","lvmax","dvmax"],te=e=>e.replace(/[^a-zA-Z0-9-_]/g,"_"),st=(e,n={})=>{const{value:t,unit:i}=e,{rootFontSize:r=typeof window<"u"&&parseFloat(getComputedStyle(document.documentElement).fontSize)||16,elementFontSize:o=r,viewportWidth:s=typeof window<"u"?window.innerWidth:0,viewportHeight:a=typeof window<"u"?window.innerHeight:0}=n;switch(i){case"cm":return t*37.8;case"mm":return t*3.78;case"q":return t*.945;case"in":return t*96;case"pt":return t*(96/72);case"pc":return t*16;case"rem":return t*r;case"rex":case"rcap":case"rch":case"rlh":{const c={rex:.5,rcap:.7,rch:.5,rlh:1.2};return t*r*c[i]}case"em":return t*o;case"ex":return t*o*.5;case"cap":return t*o*.7;case"ch":return t*o*.5;case"lh":return t*o*1.2;case"vw":case"svw":case"lvw":case"dvw":return t*s/100;case"vh":case"svh":case"lvh":case"dvh":return t*a/100;case"vi":case"svi":case"lvi":case"dvi":return t*s/100;case"vb":case"svb":case"lvb":case"dvb":return t*a/100;case"vmin":case"svmin":case"lvmin":case"dvmin":return t*Math.min(s,a)/100;case"vmax":case"svmax":case"lvmax":case"dvmax":return t*Math.max(s,a)/100;default:throw new Error(`Unsupported unit: ${i}`)}},at=e=>it.includes(e),le=(e,n={})=>{if(!be)return e;if(e.type==="unit"){const{unit:t,value:i}=e;return t==="px"||t==="%"?e:{type:"unit",value:st({unit:t,value:i},n),unit:"px"}}return{type:"unparsed",value:e.value.toLowerCase().replace(/(\d+(?:\.\d+)?)([a-z%]+)/gi,(t,i,r)=>{if(!at(r))return`${i}${r}`;const o=le({type:"unit",value:parseFloat(i),unit:r},n);return o.type!=="unit"?`${i}${r}`:`${o.value}${o.unit}`})}},ne=(e,n)=>{const t=(r,o)=>{let s=0,a=o;for(;a<r.length;){if(r[a]==="(")s++;else if(r[a]===")"&&(s--,s===0))break;a++}return{content:r.slice(o+4,a),end:a}},i=r=>{let o="",s=0;for(;s<r.length;)if(r.startsWith("sibling-index(",s)||r.startsWith("sibling-count(",s)){let a=s+14;for(;a<r.length&&r[a]!==")";)a++;o+=n(`${r.slice(s,s+14)})`),s=a+1}else if(r.startsWith("var(",s)){const{content:a,end:c}=t(r,s),u=[];let m="",l=0;for(let h=0;h<a.length;h++){const g=a[h];g==="("?l++:g===")"&&l--,g===","&&l===0?(u.push(m.trim()),m=""):m+=g}m&&u.push(m.trim());const f=u[0],d=u[1];let v=n(f);v===void 0&&d&&(v=i(d)),o+=v!==void 0?v:`var(--error-not-found${f??"-empty"})`,s=c+1}else o+=r[s],s++;return o};return i(e)},lt=(e,n=" ")=>{const t=[];let i="",r=0;const o=e.trim();for(let s=0;s<o.length;s++){const a=o[s];a==="("?r++:a===")"&&r--,a===n&&r===0?(t.push(i.trim()),i=""):i+=a}return i&&t.push(i.trim()),t.filter(Boolean)},ce=1e4,Se=e=>{if(e.length===0)return[];const n=e.map(i=>i.offset!=null?i.offset*ce:void 0);if(n.length===1&&n[0]==null)return[1];n[0]==null&&(n[0]=0),n.at(-1)==null&&(n[n.length-1]=1*ce);let t=0;for(let i=1;i<n.length-1;){if(n[i]!=null){t=i,i++;continue}if(n[i]==null){const r=n.findIndex((s,a)=>a>=i&&s!=null),o=(n[r]-n[t])/(r-t);for(let s=t+1;s<r;s++)n[s]=n[s-1]+o;t=r,i=r+1}}return n.map(i=>i/ce)},ct=e=>{const n=Se(e);if(n.length===0)return;let t={};for(let i=0;i<n.length;i++)if(n[i]===0){const r=e[i];t={...t,...r.styles}}if(Object.keys(t).length!==0)return t};function Y(e,n){let t=e.parentElement;for(;t!=null;){if(n(t))return t;t=t.parentElement}}function ut(e,n){let t=e;for(;t!=null;){if(n(t))return t;t=t.parentElement}}function dt(e){switch(getComputedStyle(e).display){case"block":case"inline-block":case"list-item":case"table":case"table-caption":case"flow-root":case"flex":case"grid":return!0}return!1}function $e(e){const n=getComputedStyle(e);return n.transform!=="none"||n.perspective!=="none"||n.willChange==="transform"||n.willChange==="perspective"||n.filter!=="none"||n.willChange==="filter"||n.backdropFilter!=="none"}function mt(e){return getComputedStyle(e).position!=="static"?!0:$e(e)}function ft(e){switch(getComputedStyle(e).position){case"static":case"relative":case"sticky":return Y(e,dt);case"absolute":return Y(e,mt);case"fixed":return Y(e,$e)}}function pt(e){if(!(!e||!e.isConnected))for(;e=ft(e);){if(document.scrollingElement===e)return e;const n=getComputedStyle(e),t=["auto","scroll","hidden"];if(t.includes(n.overflowX)||t.includes(n.overflowY))return e===document.body&&document.scrollingElement!==null&&getComputedStyle(document.scrollingElement).overflow==="visible"?document.scrollingElement:e}}function ht(e,n){switch(e){case"root":return document.scrollingElement;case"nearest":return pt(n);case"self":return n;default:throw new TypeError("Invalid ScrollTimeline Source Type.")}}const re=(e,n)=>{if(e==="closest"){const t=Y(n,i=>{const r=getComputedStyle(i),o=["auto","scroll","hidden"];return o.includes(r.overflowX)||o.includes(r.overflowY)});return t===document.body&&document.scrollingElement!==null&&getComputedStyle(document.scrollingElement).overflow==="visible"?document.scrollingElement:t}return ht(e,n)??void 0},ue=e=>{const n=ut(e,t=>getComputedStyle(t).position==="sticky");return n?.parentElement??e},Ee=(e,n)=>{const t=Y(n,i=>{const r=getComputedStyle(i);if(r.getPropertyValue("view-timeline-name")===e)return!0;if(r.getPropertyValue("--view-timeline-name").trim()===e){const o=i.parentElement;if(o===null||getComputedStyle(o).getPropertyValue("--view-timeline-name").trim()!==e)return!0}return!1});if(t!==void 0)return ue(t)},Ce="animation-ws-debug";let gt=0;const B=`${Ce}-infobox`,vt=({selector:e,getContent:n})=>{const t=O(n);return ye(()=>{t.current=n},[n]),P(()=>{const i=`infobox-container-${Ce}`;let r=document.getElementById(i);if(!r){r=document.createElement("div"),r.id=i,r.style.display="contents";const l=document.createElement("style");l.textContent=`
       .${B} {
          color: white;
          background-color: oklch(0.268 0.007 34.298 / 0.9);

          border-radius: 8px;
          padding: 10px;
          font-size: 1em;
          margin: 0.5em;
          white-space: pre-wrap;
          font-family: monospace;
          z-index: 9999;
          pointer-events: none;
        }

        /* Performance */
        .${B} {
          contain: content;
        }

        .${B} {
          position: fixed;
          position-area: top;
          position-try-fallbacks: bottom;
        }

        /* Hide if browser is unsupported */
        .${B} {
          display: none;
        }

        @supports (anchor-name: --myAnchor) {
          .${B} { display: block; }
        }
      `,r.appendChild(l),document.body.appendChild(r)}const o=new Map,s=new IntersectionObserver(l=>{for(const f of l){const d=f.boundingClientRect;o.set(f.target,{x:d.x,width:d.width})}}),a=l=>{const f=o.get(l);if(f===void 0)return{x:0,y:0};const d=l.getBoundingClientRect();return{x:d.x-f.x+d.width/2-f.width/2,y:0}},c=l=>{if(!(l instanceof HTMLElement))return()=>{};s.observe(l);const f=`--anchor-ws-${gt++}`,d=l.style.getPropertyValue("anchor-name");l.style.setProperty("anchor-name",f);const v=document.createElement("div");v.className=B,v.style.setProperty("position-anchor",f),r.appendChild(v);const h=()=>{const{x:E,y:$}=a(l),y=t.current(l);y!==v.textContent&&(v.textContent=y),v.style.setProperty("transform",`translate(${E}px, ${$}px)`),g=requestAnimationFrame(h)};let g=requestAnimationFrame(h);return()=>{cancelAnimationFrame(g),v.remove(),l.style.setProperty("anchor-name",d??"")}},u=document.querySelectorAll(e),m=[];for(const l of u)m.push(c(l));return()=>{m.forEach(l=>l()),s.disconnect()}},[e]),null},oe="data-ws-subject-for",yt=e=>({[oe]:e}),Ae=e=>`[${oe}="${e}"]`,wt=e=>e.hasAttribute(oe),bt=e=>e.getAttribute(oe)??"-",xt=e=>e.id.endsWith("-sample"),Me="data-ws-no-initial-animation",Te={[Me]:""},St=(e,n)=>{const t=Math.pow(10,n);return Math.round(e*t)/t},$t=(e,n,t,i)=>{const r=e.map(l=>l!==void 0?St(l,i):void 0),o=r.join(",");if(t.has(o))return t.get(o);const s=new Map,a=n.getAnimations(),c=new Set;for(let l=0;l<a.length;l++){const f=a[l],d=r[l];if(d===void 0){s.set(l,f.effect),f.effect=null;continue}f.currentTime=1e3*d;const v=f.effect;if(v instanceof KeyframeEffect){const h=v.getKeyframes().flatMap(g=>Object.keys(g));for(const g of h)["offset","easing","composite","computedOffset"].includes(g)||c.add(g)}}const u=getComputedStyle(n),m={};for(const l of c)m[l]=u.getPropertyValue(l);for(const[l,f]of s){const d=a[l];d!==void 0&&(d.effect=f)}return t.set(o,m),m},Et=e=>{const[n]=I(()=>{const r=new Map;for(const o of e){if(o.minWidth!==void 0){r.set(o.id,window.matchMedia(`(min-width: ${o.minWidth}px)`));continue}if(o.maxWidth!==void 0){r.set(o.id,window.matchMedia(`(max-width: ${o.maxWidth}px)`));continue}r.set(o.id,window.matchMedia("(min-width: 0px)"))}return r}),[t,i]=I(()=>[...n].map(([r,o])=>o.matches?r:void 0).filter(r=>r!==void 0));return P(()=>{const r=new AbortController;let o;const s=()=>{i(a=>{const c=[...n].map(([u,m])=>m.matches?u:void 0).filter(u=>u!==void 0);return ee(a,c)?a:c})};for(const[a,c]of n)c.addEventListener("change",()=>{cancelAnimationFrame(o),o=requestAnimationFrame(s)},{signal:r.signal});return s(),()=>{cancelAnimationFrame(o),r.abort()}},[n]),t},Ct=e=>n=>{let t;if(n===void 0)return t;const i=new Map(n);for(const r of e)t=i.get(r)??t;return t},Le=e=>{const n=new Set,t=(i,r="")=>{if(i)for(const o of i)if(o instanceof CSSStyleRule){const s=o.selectorText,a=o.style;for(let c=0;c<a.length;c++){const u=a.item(c);if(u.startsWith("--")){const m=[r,s,u,a.getPropertyValue(u).trim()].filter(Boolean).join(":::");n.add(m)}}t(o.cssRules,[r,s].filter(Boolean).join(":::"))}else if(o instanceof CSSConditionRule){const s=[r,o.conditionText].filter(Boolean).join(":::");t(o.cssRules,s)}else o instanceof CSSLayerBlockRule&&t(o.cssRules,[r,o.name].filter(Boolean).join(":::"))};try{const i=e.sheet;i&&t(i.cssRules)}catch(i){return console.error("Failed to access or parse CSS rules. This might be due to browser limitations, CSS errors, or security restrictions (for cross-origin stylesheets).",i),new Set}return n},At=()=>{const[e]=I(()=>new Promise(n=>{requestAnimationFrame(()=>{n(!0)})}));X(e)},de=new WeakMap,Mt=({subject:e,axis:n,inset:t})=>{if(!e)return new ViewTimeline({subject:e,axis:n,inset:t});const i=`${n}-${t}`;de.has(e)||de.set(e,new Map);const r=de.get(e);if(r.has(i))return r.get(i);const o=new ViewTimeline({subject:e,axis:n,inset:t});return r.set(i,o),o},ie=new WeakSet,Tt=e=>ie.has(e)?()=>{}:(ie.add(e),()=>{ie.delete(e)}),Lt=e=>ie.has(e),K="data-ws-animate-id",ke=e=>`[${K}="${e}"]`,me=(e,n=!1,t=5)=>{const i=n?`:not(:is([${K}], [${Me}]))`:`:not(:is([${K}]))`,r=[ke(e),i],o=[];for(let s=0;s<t;++s)o.push(r.join(" > ")),r.splice(1,0,`[${K}]`);return o.join(", ")},kt=(e,n)=>e.flatMap(t=>n.map(i=>[t,i])),Pe=([e,n],t,i,r)=>{const o=getComputedStyle(t),s=parseFloat(o.fontSize);let a={...n};a.type==="var"&&(a={type:"unparsed",value:V(a)}),a.type==="unparsed"&&(a.value=ne(V(a),u=>u==="--index"?`${i}`:u==="--total"?`${r}`:u==="sibling-index()"?`${i}`:u==="sibling-count()"?`${r}`:o.getPropertyValue(u)));const c=V(le(a,{elementFontSize:s}));if(!CSS.supports("margin-top",c))switch(console.warn(`Invalid range value "${c}"`),e){case"start":return"0%";case"end":return"100%";default:return e}switch(e){case"start":return`calc(0% + ${c})`;case"end":return`calc(100% - ${c})`;case"contain":case"cover":case"entry":case"exit":case"entry-crossing":case"exit-crossing":return`${e} calc(0% + ${c})`}},je=(e,n,t,i,r)=>{const o=getComputedStyle(t),s=parseFloat(o.fontSize);let a={...e};if(a.type==="keyword"){let u=o.getPropertyValue("view-timeline-inset");if(u===""&&(u=o.getPropertyValue("--view-timeline-inset")),u==="")return e.value;const m=lt(u);a={type:"unparsed",value:n==="start"?m[0]:m[1]??m[0]}}a.type==="unparsed"&&(a.value=ne(a.value,u=>u==="--index"?`${i}`:u==="--total"?`${r}`:o.getPropertyValue(u)));const c=V(le(a,{elementFontSize:s}));return CSS.supports("margin-top",c)?c:(console.warn(`Invalid inset value "${c}"`),"0%")},Pt=(e,n,t,i,r)=>{switch(e.type){case"scroll":{const o=re(e.source??"root",n);if(o===void 0){console.error("Source is not found ",e.source);return}return new ScrollTimeline({source:o,axis:e.axis??"block"})}case"view":{const o=e.subject?Ee(e.subject,n):ue(r.get(n.id)??n);if(o==null){console.error("Subject is not found ",e.subject);return}const s=je(e.insetStart??{type:"keyword",value:"auto"},"start",n,t,i),a=je(e.insetEnd??{type:"keyword",value:"auto"},"end",n,t,i);return Mt({subject:o,axis:e.axis??"block",inset:`${s} ${a}`})}}},jt=e=>{if(e===void 0)return 1;const n=Number.parseFloat(e);return Number.isNaN(n)?1:e.endsWith("ms")?n:e.endsWith("s")?n*1e3:n},Ft=(e,n,t)=>`${n}-=#=-${e}-=#=-${t}`,It=e=>e.split("-=#=-")[0],Nt=new Set(["STYLE","SCRIPT","LINK","META","TITLE"]),se=(e,n)=>(...t)=>{try{return e.animate(...t)}catch(i){n(i);return}},Ot=({id:e,action:n,breakpoints:t,isCanvas:i,onError:r})=>{const o=Et(t),s=Je(()=>Ct(o),[o]);ye(()=>{if(!window.matchMedia("(prefers-reduced-motion: no-preference)").matches)return;const a=me(e),c=document.querySelectorAll(a);if(c.length===0)return;const u=(n.type,kt(Array.from(c),n.animations)).length,m=new AbortController,l=[];l.push(()=>{m.abort()});let f=0;const d=new Map,v=h=>d.has(h.id);for(const h of c)if(h instanceof HTMLElement&&!Nt.has(h.tagName)){if(wt(h)){d.set(bt(h),h);continue}for(const g of n.animations){if(s(g.enabled)===!1)continue;const E=Pt(n,h,f,u,d);if(E===void 0)return;const $=getComputedStyle(h);let y=g.timing.easing?ne(g.timing.easing,k=>$.getPropertyValue(k)):"linear";y=CSS.supports("animation-timing-function",y)?y:"linear";const S={easing:y,fill:g.timing.fill},w=g.timing.rangeStart?Pe(g.timing.rangeStart,h,f,u):void 0;let p=g.timing.rangeEnd?Pe(g.timing.rangeEnd,h,f,u):void 0;const x=g.keyframes.map(k=>{const N={offset:k.offset};for(const[j,F]of Object.entries(k.styles)){if(j.startsWith("--")){const q=getComputedStyle(h).getPropertyValue(j)||"0";try{"registerProperty"in CSS&&CSS.registerProperty({syntax:["<number> | <number>+ | <number>#","<angle> | <angle>+ | <angle>#","<color> | <color>+ | <color>#","<length> | <length>+ | <length>#","<integer> | <integer>+ | <integer>#","<percentage> | <percentage>+ | <percentage>#","<length-percentage> | <length-percentage>+ | <length-percentage>#","<resolution> | <string> | <time> | <custom-ident> | <image>","<transform-function> | <transform-list> | <url>"].join(" | "),inherits:!0,initialValue:q,name:j})}catch(H){H instanceof DOMException&&H.name==="InvalidModificationError"||console.error(`Property registration error property="${j}" value="${q}"`,H)}N[j]=V(F);continue}N[Qe(j)]=V(F)}return N});let b;const M=g.timing.duration===void 0?void 0:jt(ne(V(g.timing.duration),k=>$.getPropertyValue(k))),A={...S};let T=x;const L=Ft(e,`${g.name??"-"}`,f);if(M!==void 0)if(p=w,i)A.fill==="both"&&(A.fill="backwards"),A.fill==="forwards"&&(A.fill="none");else{A.fill==="backwards"&&(A.fill="both"),A.fill==="none"&&(A.fill="forwards");const k=Se(x),N=x.filter((j,F)=>k[F]===0);T=[...N.map(j=>({...j,offset:0})),...N.map(j=>({...j,offset:1}))]}const W=M!==void 0?k=>{k.addEventListener("finish",()=>{i||k.cancel();const N=se(h,r)(x,{...S,duration:M,id:L});if(l.push(()=>{N?.cancel()}),!i)return;const j=n.type==="scroll"?document.scrollingElement:n.type==="view"&&n.subject?Ee(n.subject,h):ue(d.get(h.id)??h);if(j==null)return;const F=re("nearest",j);if(F==null)return;const q=F===document.scrollingElement?document:F,H=n.axis??"block",pe=H==="block"||H==="y";let he=pe?F.scrollTop:F.scrollLeft;const ge=()=>{const ve=pe?F.scrollTop:F.scrollLeft;ve<he&&(N?.cancel(),q.removeEventListener("scroll",ge)),he=ve};q.addEventListener("scroll",ge,{signal:m.signal,passive:!0})},{signal:m.signal})}:()=>{};v(h)?(b=se(h,r)([],{...A,timeline:E,rangeStart:w,rangeEnd:p,duration:1,id:L}),M!==void 0&&b!==void 0&&l.push(Tt(b)),b!==void 0&&W(b)):xt(h)?(b=se(h,r)(x,{easing:"linear",fill:"both",duration:1e3,id:L}),b?.pause()):(b=se(h,r)(T,{...A,timeline:E,rangeStart:w,rangeEnd:p,duration:1,id:L}),b&&W(b),f++),l.push(()=>{b?.cancel()})}}return()=>{l.forEach(h=>h())}},[n,e,i,s,r])},Fe=({id:e,action:n})=>{const t=me(e,!0),i=n.animations.filter(a=>a.timing.fill==="backwards"||a.timing.fill==="both");let r="";const o=`${t} { animation: none; }`,s=new Map;for(const a of i){const c=ct(a.keyframes);if(c!==void 0)for(const[u,m]of Object.entries(c))s.set(u,V(m))}return r=`
    ${r}

    @keyframes ws-scroll-animation-${e} {
      from {
        ${[...s.entries()].map(([a,c])=>`${a}:${c};`).join(`
`)}
      }
    }

    @media (prefers-reduced-motion: no-preference) {
      ${t} {
        animation-name: ws-scroll-animation-${e};
        animation-fill-mode: backwards;
        animation-play-state: paused;
        animation-duration: 1ms;
      }
    }
    `,_(Q,{children:[C("style",{dangerouslySetInnerHTML:{__html:r}}),C("noscript",{children:C("style",{dangerouslySetInnerHTML:{__html:o}})})]})},Wt=e=>{const n=e.getAnimations().map(r=>{var o;return{id:r.id,name:It(r.id),progress:(o=r.effect)==null?void 0:o.getComputedTiming().progress}}),t=[...new Map(n.map(({id:r,name:o,progress:s})=>s==null?[r,`${o}: idle`]:[r,`${o}: ${(s*100).toFixed(1)}%`])).values()];if(t.length===0)return"";const i=Math.max(...t.map(r=>r.length));return t.map(r=>{const o=r.lastIndexOf(" ");if(o===-1)return r.padEnd(i);const s=r.substring(0,o),a=r.substring(o+1),c=i-r.length;return`${s}${" ".repeat(c+1)}${a}`}).join(`
`)},Vt=R(({debug:e=!1,children:n,action:t,[Ge]:i,...r},o)=>{const s=G(),a=te(s),[c,u]=I(0),[m,l]=I(0),f=O(t?.isPinned),{renderer:d,breakpoints:v,onError:h}=U(Z),g=O(v);P(()=>{const p=new AbortController;return document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&u(x=>x+1)},{signal:p.signal,once:!0}),()=>{p.abort()}},[]),P(()=>{if(d!=="canvas")return;const p=document.querySelector('style[data-webstudio="user-styles"]');if(p===null){console.error('Style element with attribute `data-webstudio="user-styles"` not found');return}if(!(p instanceof HTMLStyleElement))return;let x=Le(p);const b=new MutationObserver(()=>{const M=Le(p);M.symmetricDifference(x).size!==0&&(u(A=>A+1),x=M)});return b.observe(p,{childList:!0,subtree:!0,characterData:!0}),()=>{b.disconnect()}},[a,d]),P(()=>{if(d===void 0)return;const p=new AbortController;return window.addEventListener("resize",()=>{u(x=>x+1)},{signal:p.signal}),()=>{p.abort()}},[a,d]),P(()=>{t?.isPinned!==f.current&&(f.current=t?.isPinned,t!=null&&t.isPinned&&(l(p=>p+1),u(p=>p+1)))},[t?.isPinned]),P(()=>{d!==void 0&&g.current===v&&(g.current=v,u(p=>p+1))},[v,d]),P(()=>{const p=ke(a),x=document.querySelector(p);if(x===null){console.error(`Element with selector ${p} not found`);return}const b=new MutationObserver(M=>{const A=new Set;M.forEach(T=>{T.type==="childList"&&(T.addedNodes.forEach(L=>{L instanceof HTMLElement&&L.tagName==="STYLE"||L instanceof HTMLElement&&L.tagName==="NOSCRIPT"||A.add(L)}),T.removedNodes.forEach(L=>{A.delete(L)}))}),A.size>0&&u(T=>T+1)});return b.observe(x,{childList:!0,subtree:!1}),x.parentElement!==null&&b.observe(x.parentElement,{childList:!0,subtree:!1}),()=>{b.disconnect()}},[a,m]);const E=d==="canvas",$=E?(t?.isPinned??!1)||(i??!1):!0,y=d===void 0?!1:t?.debug??!1,S=d==="canvas"&&J.count(n)===0,w=S?"Add the instances you want to animate.":n;return _(Q,{children:[t&&$&&C(Ze,{fallback:C(Fe,{id:a,action:t,reason:"Client Only"}),children:_(De,{fallback:C(Fe,{id:a,action:t,reason:"Suspense"}),children:[_(Xe,{fallback:null,onError:p=>{console.error("Polyfill loading error",p)},children:[C(nt,{}),e&&C(ot,{}),d==="canvas"&&C(At,{})]}),C(Ot,{id:a,action:t,breakpoints:v,isCanvas:E,onError:h},`${c}`),y&&C(vt,{selector:me(a),getContent:Wt},`${c}-debug`)]})}),Be("div",{ref:o,[K]:a,...r,style:S?void 0:{display:"contents"},key:m},w)]})}),Ie=(e,n,t)=>{const i=[],r=[];let o;const s=()=>{const m=r.every(Boolean);m!==o&&(e(m),o=m)};let a=n,c=re("nearest",a);const u=[];for(;c;){const m=i.length;r.push(!1);const l=c===document.scrollingElement?document:c,f=new IntersectionObserver(d=>{d.forEach(v=>{r[m]=v.isIntersecting}),s()},{root:l,rootMargin:t});f.observe(a),i.push(f),u.push(()=>{f.unobserve(a),f.disconnect()}),a=c,c=re("nearest",a)}return()=>{u.forEach(m=>{m()})}},qt=e=>{let n;const t=()=>{e(),n=requestAnimationFrame(t)};return n=requestAnimationFrame(t),()=>{cancelAnimationFrame(n)}},Rt=String.raw,fe=R(({children:e,...n},t)=>{const i=O(null),r=O(null),o=G(),s=te(o),a=`${s}-sample`,[c]=I(()=>new Map),[u]=I(()=>Rt`
        #${s} {
          position: fixed;
          visibility: hidden;
          pointer-events: none;
          top: -10000px;
          right: 10000px;
          contain: strict;
        }

        #${a} {
          position: fixed;
          visibility: hidden;
          pointer-events: none;
          top: -9000px;
          right: 9000px;
          willchange: translate, scale, opacity;
          contain: strict;
        }
      `),[m]=I(()=>(d,v)=>r.current?$t(d,r.current,c,v):{}),[l]=I(()=>we([])),[f]=I(()=>we(!1));return P(()=>{const d=document.querySelector(Ae(s));if(d===null)return;let v=[],h=[],g=[];const E=()=>{if(!i.current||!r.current)return;const S=i.current.getAnimations(),w=!ee(v,S);v=S;const p=S.map(T=>T.playState),x=!ee(g,p);g=p,w&&c.clear();const b=r.current.getAnimations(),M=b?.map(T=>{var L,W;const k=S.findLast(({id:q})=>q===T.id);if(k===void 0)return;const N=(L=k.effect)==null?void 0:L.getTiming().fill,j=k.playState,F=(W=k.effect)==null?void 0:W.getComputedTiming().progress;return j==="running"&&(N==="backwards"||N==="both")&&F===null||Lt(k)?0:F??void 0})??void 0,A=!ee(h,M);h=M,(w||A||x)&&l.set(M)};E();let $=()=>{};const y=Ie(S=>{$(),S&&($=qt(E))},d,`${Math.round(Math.max(window.innerWidth/2,window.innerHeight/2))}px`);return()=>{y(),$()}},[l,s,c]),P(()=>{const d=document.querySelector(Ae(s));if(d===null)return;const v=Ie(h=>{f.set(h)},d,"0px");return()=>{v()}},[f,s]),_(Q,{children:[C("div",{ref:t,...yt(s),...n,children:e(l,f,m)}),C("style",{dangerouslySetInnerHTML:{__html:u}}),C("div",{id:s,ref:i,inert:"true",...Te}),C("div",{id:a,ref:r,inert:"true",...Te})]})}),Ht=e=>e*e,_t=e=>e*e*e,zt=e=>e*e*e*e,Bt=e=>1-(1-e)*(1-e),Dt=e=>1-Math.pow(1-e,3),Jt=e=>1-Math.pow(1-e,4),Yt=e=>e<.5?2*e*e:1-2*(1-e)*(1-e),Kt=e=>3*e*e-2*e*e*e,Qt=e=>e<.5?8*e*e*e*e:1-8*Math.pow(1-e,4),Xt=e=>e,Ne={linear:Xt,easeIn:Ht,easeInCubic:_t,easeInQuart:zt,easeOut:Bt,easeOutCubic:Dt,easeOutQuart:Jt,ease:Yt,easeInOutCubic:Kt,easeInOutQuart:Qt},D="data-ws-text-animate",Oe="data-ws-text-non-animate",Gt=(e,n)=>{let t=0;const i=document.createNodeIterator(e,NodeFilter.SHOW_TEXT,{acceptNode:s=>{var a;return(a=s.parentElement)!=null&&a.hasAttribute(D)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),r=[],o=[];for(let s=i.nextNode();s!==null;s=i.nextNode())r.push(s);for(const s of r){const a=s.nodeValue;if(a===null||a.trim().length===0)continue;const c=a.split(n),u=document.createDocumentFragment();for(const f of c){const d=document.createElement("span");typeof n=="string"||f.match(n)===null?d.setAttribute(D,`${t++}`):d.setAttribute(Oe,""),d.textContent=f,u.appendChild(d)}if(!(s instanceof CharacterData)){console.warn("textNode is not an instance of CharacterData");continue}const m=s.parentElement,l=s.nextSibling;o.push(()=>{m!==null&&(l?m.insertBefore(s,l):m.appendChild(s))}),s.replaceWith(u)}return[e.querySelectorAll(`span[${D}]`),()=>{for(const s of e.querySelectorAll(`span[${D}], span[${Oe}]`))s.remove();for(const s of o)s()}]},Ut=(e,n,t,i)=>{if(t===0)return i<n?0:1;const r=(i-(n-t))/t;return r<=0?0:r>=1?1:e(r)},Zt=(e,n,t)=>Math.min(Math.max(e,n),t),We="data-ws-animate-text-id",ae=e=>`[${We}="${e}"]`,en=(e,n)=>e.map(t=>t!==void 0?t*n:void 0),tn=R(({$progress:e,slidingWindow:n,easing:t,splitBy:i,getStylesAt:r,onRender:o,children:s,progressPrecision:a=3,...c},u)=>{n=Math.max(0,n);const m=G(),l=te(m),f=O(),d=O([]),v=O(r);v.current=r;const[h,g]=I(0),[E]=I(()=>`
    ${ae(l)} span[${D}] {
      display: inline-block;
      will-change: translate, scale, opacity;
    }

    ${ae(l)} *:has(> span[${D}]) {
      white-space-collapse: preserve;
    }
  `);return P(()=>{const $=document.querySelector(ae(l));if(!$)return;const[y,S]=Gt($,i);return f.current=y,d.current=[],S},[l,i,h]),P(()=>{const $=document.querySelector(ae(l));if(!$)return;const y=new MutationObserver(S=>{const w=new Set;let p=!1;S.forEach(x=>{x.type==="childList"&&(x.addedNodes.forEach(b=>{if(b instanceof HTMLElement&&b.isContentEditable){p=!0;return}w.add(b)}),x.removedNodes.forEach(b=>{if(w.has(b)){w.delete(b);return}w.add(b)}))}),!p&&w.size>0&&g(x=>x+1)});return y.observe($,{childList:!0,subtree:!0}),()=>{y.disconnect()}},[l,h]),P(()=>e.subscribe($=>{const y=f.current;if(y===void 0||y.length===0)return;const S=[];for(let w=0;w<y.length;w++){const p=y[w];if($.length===0){if(d.current[w]===void 0)continue;p.style.cssText="",d.current[w]=void 0;continue}const x=y.length+n-1,b=en($,x),M=Ne[t],A=b.map(W=>W===void 0?void 0:1-Ut(M,Zt(W,0,x),n,w)),T=v.current(A,a),L=JSON.stringify(T);d.current[w]!==L&&(S.push([p,T]),d.current[w]=L)}for(const[w,p]of S){w.style.cssText="";for(const[x,b]of Object.entries(p))w.style.setProperty(x,b)}o?.()}),[l,e,n,t,o,a,h]),_(Q,{children:[C("style",{dangerouslySetInnerHTML:{__html:E}}),C("div",{ref:u,[We]:l,...c,style:{display:"contents"},children:s},h)]})}),nn={char:"",space:/( )/,'symbol "#"':/#/,'symbol "~"':/~/},Ve=R(({charWindow:e=5,easing:n="linear",splitBy:t="char",children:i,...r},o)=>{const{renderer:s}=U(Z),a=s==="canvas"&&J.count(i)===0?"Add content, and all text inside will be animated.":i;return C(fe,{ref:o,...r,children:(c,u,m)=>C(tn,{$progress:c,getStylesAt:m,slidingWindow:e,easing:n,splitBy:nn[t],children:a})})}),rn="AnimateText";Ve.displayName=rn;const on=(e,n,t,i)=>{if(t===0)return i<n?0:1;const r=(i-(n-t))/t;return r<=0?0:r>=1?1:e(r)},sn=(e,n,t)=>Math.min(Math.max(e,n),t),qe="data-ws-staggering-animation-id",Re=e=>`[${qe}="${e}"]`,an=(e,n)=>e.map(t=>t!==void 0?t*n:void 0),ln=R(({$progress:e,slidingWindow:n,easing:t,getStylesAt:i,onRender:r,children:o,progressPrecision:s=3,...a},c)=>{n=Math.max(0,n);const u=G(),m=te(u),l=O(),f=O([]),d=O(i);d.current=i;const[v,h]=I(0);return P(()=>{const g=document.querySelector(Re(m));if(!g)return;const E=Array.from(g.children).filter($=>$ instanceof HTMLElement);l.current=E,f.current=[]},[m,v]),P(()=>{const g=document.querySelector(Re(m));if(!g)return;const E=new MutationObserver($=>{const y=new Set;let S=!1;$.forEach(w=>{w.type==="childList"&&(w.addedNodes.forEach(p=>{if(p instanceof HTMLElement&&p.isContentEditable){S=!0;return}y.add(p)}),w.removedNodes.forEach(p=>{if(y.has(p)){y.delete(p);return}y.add(p)}))}),!S&&y.size>0&&h(w=>w+1)});return E.observe(g,{childList:!0,subtree:!1}),()=>{E.disconnect()}},[m,v]),P(()=>e.subscribe(g=>{const E=l.current;if(E===void 0||E.length===0)return;const $=[];for(let y=0;y<E.length;y++){const S=E[y];if(g.length===0){if(f.current[y]===void 0)continue;S.style.cssText="",f.current[y]=void 0;continue}const w=E.length+n-1,p=an(g,w),x=Ne[t],b=p.map(T=>T===void 0?void 0:1-on(x,sn(T,0,w),n,y)),M=d.current(b,s),A=JSON.stringify(M);f.current[y]!==A&&($.push([S,M]),f.current[y]=A)}for(const[y,S]of $){y.style.cssText="";for(const[w,p]of Object.entries(S))y.style.setProperty(w,p)}r?.()}),[m,e,n,t,r,s,v]),C("div",{ref:c,[qe]:m,...a,style:{display:"contents"},children:o},v)}),He=R(({charWindow:e=1,easing:n="linear",children:t,...i},r)=>{const{renderer:o}=U(Z),s=o==="canvas"&&J.count(t)===0?"Add children.":t;return C(fe,{ref:r,...i,children:(a,c,u)=>C(ln,{$progress:a,getStylesAt:u,slidingWindow:e,easing:n,children:s})})}),cn="StaggerAnimation";He.displayName=cn;const un=({$progress:e,$visible:n,$timeline:t,children:i})=>{const[r]=I(()=>Ue([e],o=>o[0]));return J.map(i,o=>Ye(o)?Ke(o,{$progress:r,$visible:n,$timeline:t}):o)},dn=()=>R(({children:e,timeline:n,...t},i)=>{const{renderer:r}=U(Z),o=r==="canvas"&&J.count(e)===0?"Add children.":e;return C(fe,{ref:i,...t,children:(s,a)=>C(un,{$progress:s,$timeline:n,$visible:a,children:o})})}),_e=dn(),mn="VideoAnimation";_e.displayName=mn;export{Vt as AnimateChildren,Ve as AnimateText,He as StaggerAnimation,_e as VideoAnimation};
