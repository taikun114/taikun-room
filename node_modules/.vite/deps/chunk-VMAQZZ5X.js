import {
  createJsonStringifyProxy,
  isPlainObject
} from "./chunk-FFVU4N47.js";
import {
  require_jsx_runtime
} from "./chunk-A7TAK4KR.js";
import {
  require_react
} from "./chunk-OXMAUKK4.js";
import {
  __toESM
} from "./chunk-DC5AMYBS.js";

// node_modules/@webstudio-is/react-sdk/lib/runtime.js
var import_react = __toESM(require_react());
var import_react2 = __toESM(require_react());
var import_react3 = __toESM(require_react());
var import_jsx_runtime = __toESM(require_jsx_runtime());
var import_react4 = __toESM(require_react());
var import_jsx_runtime2 = __toESM(require_jsx_runtime());
var import_react5 = __toESM(require_react());
var import_jsx_runtime3 = __toESM(require_jsx_runtime());
var ReactSdkContext = (0, import_react.createContext)({
  assetBaseUrl: "/",
  imageLoader: ({ src }) => src,
  resources: {},
  breakpoints: [],
  onError: (error) => {
    console.error(error);
  }
});
var useResource = (name) => {
  const { resources } = (0, import_react.useContext)(ReactSdkContext);
  const resource = resources[name];
  const resourceMemozied = (0, import_react.useMemo)(
    () => isPlainObject(resource) ? createJsonStringifyProxy(resource) : resource,
    [resource]
  );
  return resourceMemozied;
};
var getClosestInstance = (instancePath, currentInstance, closestComponent) => {
  let matched = false;
  for (const instance of instancePath) {
    if (currentInstance === instance) {
      matched = true;
    }
    if (matched && instance.component === closestComponent) {
      return instance;
    }
  }
};
var useVariableState = (initialState) => {
  const [state, setState] = (0, import_react2.useState)(initialState);
  const value = (0, import_react2.useMemo)(
    () => isPlainObject(state) ? createJsonStringifyProxy(state) : state,
    [state]
  );
  return [value, setState];
};
var isElementRenderedWithReact = (element) => {
  return Object.keys(element).some((key) => key.startsWith("__react"));
};
var isServer = typeof window === "undefined";
var Meta = (props) => {
  const [localProps, setLocalProps] = (0, import_react3.useState)();
  (0, import_react3.useEffect)(() => {
    const selector = `meta[${props.name ? `name="${props.name}"` : `property="${props.property}"`}]`;
    let allMetas = document.querySelectorAll(selector);
    for (const meta of allMetas) {
      if (!isElementRenderedWithReact(meta)) {
        meta.remove();
      }
    }
    allMetas = document.querySelectorAll(selector);
    if (allMetas.length === 0) {
      setLocalProps(props);
    }
  }, [props]);
  if (isServer) {
    return (0, import_jsx_runtime.jsx)("meta", { ...props });
  }
  if (localProps === void 0) {
    return;
  }
  return (0, import_jsx_runtime.jsx)("meta", { ...localProps });
};
var PageSettingsMeta = ({
  url,
  host,
  siteName,
  pageMeta,
  imageLoader,
  assetBaseUrl
}) => {
  const metas = [];
  if (url !== void 0) {
    metas.push({
      property: "og:url",
      content: url
    });
  }
  if (pageMeta.title) {
    metas.push({
      property: "og:title",
      content: pageMeta.title
    });
  }
  metas.push({ property: "og:type", content: "website" });
  if (siteName) {
    metas.push({
      property: "og:site_name",
      content: siteName
    });
  }
  if (pageMeta.excludePageFromSearch) {
    metas.push({
      name: "robots",
      content: "noindex, nofollow"
    });
  }
  if (pageMeta.description) {
    metas.push({
      name: "description",
      content: pageMeta.description
    });
    metas.push({
      property: "og:description",
      content: pageMeta.description
    });
  }
  if (pageMeta.socialImageAssetName) {
    metas.push({
      property: "og:image",
      content: `https://${host}${imageLoader({
        src: `${assetBaseUrl}${pageMeta.socialImageAssetName}`,
        // Do not transform social image (not enough information do we need to do this)
        format: "raw"
      })}`
    });
  } else if (pageMeta.socialImageUrl) {
    metas.push({
      property: "og:image",
      content: pageMeta.socialImageUrl
    });
  }
  metas.push(...pageMeta.custom);
  const isTwitterCardSizeDefined = pageMeta.custom.some(
    (meta) => meta.property === "twitter:card"
  );
  if ((pageMeta.socialImageAssetName !== void 0 || pageMeta.socialImageUrl !== void 0) && isTwitterCardSizeDefined === false) {
    metas.push({ property: "twitter:card", content: "summary_large_image" });
  }
  return metas.map((meta, index) => (0, import_jsx_runtime.jsx)(Meta, { ...meta }, index));
};
var isServer2 = typeof window === "undefined";
var PageSettingsTitle = (props) => {
  const [localProps, setLocalProps] = (0, import_react4.useState)();
  (0, import_react4.useEffect)(() => {
    const selector = `head > title`;
    let allTitles = document.querySelectorAll(selector);
    for (const meta of allTitles) {
      if (!isElementRenderedWithReact(meta)) {
        meta.remove();
      }
    }
    allTitles = document.querySelectorAll(selector);
    if (allTitles.length === 0) {
      setLocalProps(props);
    }
  }, [props]);
  if (isServer2) {
    return (0, import_jsx_runtime2.jsx)("title", { ...props });
  }
  if (localProps === void 0) {
    return;
  }
  return (0, import_jsx_runtime2.jsx)("title", { ...localProps });
};
var isServer3 = typeof window === "undefined";
var PageSettingsCanonicalLink = (props) => {
  const [localProps, setLocalProps] = (0, import_react5.useState)();
  (0, import_react5.useEffect)(() => {
    const selector = `head > link[rel="canonical"]`;
    let allLinks = document.querySelectorAll(selector);
    for (const meta of allLinks) {
      if (!isElementRenderedWithReact(meta)) {
        meta.remove();
      }
    }
    allLinks = document.querySelectorAll(selector);
    if (allLinks.length === 0) {
      setLocalProps(props);
    }
  }, [props]);
  if (isServer3) {
    return (0, import_jsx_runtime3.jsx)("link", { rel: "canonical", ...props });
  }
  if (localProps === void 0) {
    return;
  }
  return (0, import_jsx_runtime3.jsx)("link", { rel: "canonical", ...localProps });
};
var xmlNodeTagSuffix = "-ws-xml-node-fb77f896-8e96-40b9-b8f8-90a4e70d724a";

export {
  ReactSdkContext,
  useResource,
  getClosestInstance,
  useVariableState,
  PageSettingsMeta,
  PageSettingsTitle,
  PageSettingsCanonicalLink,
  xmlNodeTagSuffix
};
//# sourceMappingURL=chunk-VMAQZZ5X.js.map
